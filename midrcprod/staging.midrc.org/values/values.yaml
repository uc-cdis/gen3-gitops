ambassador:
  enabled: true
  jupyterNamespace: "jupyter-pods-midrcstaging-helm"  
arborist:
  autoscaling:
    enabled: false
    maxReplicas: 4
    minReplicas: 1
    targetCPUUtilizationPercentage: 40
  replicaCount: 4
  enabled: true
  image:
    repository: 707767160287.dkr.ecr.us-east-1.amazonaws.com/gen3/arborist
    tag: '2025.09'
audit:
  enabled: true
  externalSecrets:
    auditG3auto: midrcstaging-audit-g3auto
  image:
    repository: 707767160287.dkr.ecr.us-east-1.amazonaws.com/gen3/audit-service
    tag: '2025.09'
  serviceAccount:
    annotations:
      eks.amazonaws.com/role-arn: arn:aws:iam::813684607867:role/midrcprod--midrcstaging-helm--audit-sqs-receiver
aws-es-proxy:
  autoscaling:
    enabled: false
    maxReplicas: 4
    minReplicas: 1
    targetCPUUtilizationPercentage: 40
  replicaCount: 4
  enabled: true
  esEndpoint: vpc-midrcprod-gen3-metadata-2-g3zccvv7awc5samwqp62bc5g6y.us-east-1.es.amazonaws.com
  image:
    repository: quay.io/cdis/aws-es-proxy
    tag: v1.3.1
awshelper:
  enabled: true
  image:
    repository: 707767160287.dkr.ecr.us-east-1.amazonaws.com/gen3/awshelper
    tag: '2025.09'
dashboard:
  dashboardConfig:
    bucket: dashboard-813684607867-midrcprod-gen3
    prefix: midrcstaging.midrc.org
  enabled: true
  image:
    repository: 707767160287.dkr.ecr.us-east-1.amazonaws.com/gen3/gen3-statics
    tag: '2025.08'
  serviceAccount:
    annotations:
      eks.amazonaws.com/role-arn: arn:aws:iam::813684607867:role/midrcprod--midrcstaging-helm--dashboard-access
dicom-server:
  enabled: true
  image:
    repository: 707767160287.dkr.ecr.us-east-1.amazonaws.com/gen3/gen3-orthanc
    tag: gen3-0.1.2
  replicaCount: 1
  externalSecrets:
    orthancG3Auto: midrcstaging-orthanc-g3auto
etl:
  esEndpoint: elasticsearch
  etlMapping:
    mappings:
      - aggregated_props:
          - fn: count
            name: _imaging_studies_count
            path: imaging_studies
          - fn: count
            name: _ct_series_file_count
            path: imaging_studies.ct_series_files
          - fn: count
            name: _cr_series_file_count
            path: imaging_studies.cr_series_files
          - fn: count
            name: _dx_series_file_count
            path: imaging_studies.dx_series_files
          - fn: count
            name: _mr_series_file_count
            path: imaging_studies.mr_series_files
        doc_type: case
        joining_props:
          - index: data_file
            join_on: _case_id
            props:
              - fn: set
                name: object_id
                src: object_id
              - fn: set
                name: data_format
                src: data_format
              - fn: set
                name: data_type
                src: data_type
              - fn: set
                name: data_category
                src: data_category
              - fn: set
                name: data_file_image_data_modified
                src: image_data_modified
              - fn: set
                name: data_file_image_data_modification_name
                src: image_data_modification_name
              - fn: set
                name: data_file_image_data_modification_method
                src: image_data_modification_method
              - fn: count
                name: data_file_count
                src: _data_file_id
        name: midrcstaging_case
        nested_props:
          - name: case_annotations
            path: annotations
            props:
              - name: annotation_method
              - name: annotator_id
          - name: imaging_study_annotations
            path: imaging_studies.annotations
            props:
              - name: airspace_disease_grading
              - name: class_covid19_pneumonia
              - name: annotation_name
              - name: midrc_mRALE_score
              - name: annotation_method
              - name: annotator_id
              - name: instance_uids
          - name: measurements
            path: measurements
            props:
              - name: test_days_from_index
              - name: test_method
              - name: test_name
              - name: test_result_text
          - name: medications
            path: medications
            props:
              - name: days_to_medication_end
              - name: days_to_medication_start
              - name: dose_sequence_number
              - name: medication_code
              - name: medication_code_system
              - name: medication_manufacturer
              - name: medication_name
              - name: medication_type
          - name: conditions
            path: conditions
            props:
              - name: condition_code
              - name: condition_code_system
              - name: condition_name
              - name: days_to_condition_end
              - name: days_to_condition_start
          - name: procedures
            path: procedures
            props:
              - name: breathing_support_type
              - name: days_to_procedure_end
              - name: days_to_procedure_start
              - name: procedure_name
          - name: imaging_studies
            path: imaging_studies
            props:
              - name: age_at_imaging
              - name: body_part_examined
              - name: days_from_study_to_neg_covid_test
              - name: days_from_study_to_pos_covid_test
              - name: days_to_study
              - name: image_data_modified
              - name: loinc_code
              - name: loinc_contrast
              - name: loinc_long_common_name
              - name: loinc_method
              - name: loinc_system
              - name: study_description
              - name: study_modality
              - name: study_year
              - name: study_uid
        parent_props:
          - path: datasets[dataset_submitter_id:submitter_id,license,data_url_doi,data_contributor]
        props:
          - name: project_id
          - name: submitter_id
          - name: sex
          - name: race
          - name: age_at_index
          - name: index_event
          - name: zip
          - name: covid19_positive
          - name: ethnicity
        root: case
        type: aggregator
      - doc_type: measurement
        name: midrcstaging_measurement
        parent_props:
          - path: cases.datasets[dataset_submitter_id:submitter_id,license,data_url_doi,data_contributor]
        props:
          - name: project_id
          - name: submitter_id
          - name: case_ids
          - name: test_days_from_index
          - name: test_method
          - name: test_name
          - name: test_result_text
        root: measurement
        type: aggregator
      - doc_type: annotation
        name: midrcstaging_annotation
        props:
          - name: project_id
          - name: submitter_id
          - name: case_ids
          - name: airspace_disease_grading
          - name: class_covid19_pneumonia
          - name: annotation_name
          - name: midrc_mRALE_score
          - name: annotation_method
          - name: annotator_id
          - name: instance_uids
        root: annotation
        type: aggregator
      - aggregated_props:
          - fn: count
            name: _cr_series_file_count
            path: cr_series_files
          - fn: count
            name: _ct_series_file_count
            path: ct_series_files
          - fn: count
            name: _dx_series_file_count
            path: dx_series_files
          - fn: count
            name: _mr_series_file_count
            path: mr_series_files
        doc_type: imaging_study
        joining_props:
          - index: data_file
            join_on: _imaging_study_id
            props:
              - fn: set
                name: object_id
                src: object_id
              - fn: set
                name: data_format
                src: data_format
              - fn: set
                name: data_type
                src: data_type
              - fn: set
                name: data_category
                src: data_category
              - fn: set
                name: data_file_source_node
                src: source_node
              - fn: set
                name: data_file_annotation_name
                src: annotation_name
              - fn: set
                name: data_file_annotation_method
                src: annotation_method
              - fn: set
                name: data_file_image_data_modified
                src: image_data_modified
              - fn: set
                name: data_file_image_data_modification_name
                src: image_data_modification_name
              - fn: set
                name: data_file_image_data_modification_method
                src: image_data_modification_method
        name: midrcstaging_imaging_study
        nested_props:
          - name: imaging_study_annotations
            path: annotations
            props:
              - name: airspace_disease_grading
              - name: class_covid19_pneumonia
              - name: annotation_name
              - name: midrc_mRALE_score
              - name: annotation_method
              - name: annotator_id
              - name: instance_uids
        parent_props:
          - path: cases[sex,race,age_at_index,index_event,zip,covid19_positive,ethnicity].datasets[dataset_submitter_id:submitter_id,license,data_url_doi,data_contributor]
        props:
          - name: project_id
          - name: submitter_id
          - name: case_ids
          - name: age_at_imaging
          - name: body_part_examined
          - name: days_from_study_to_neg_covid_test
          - name: days_from_study_to_pos_covid_test
          - name: days_to_study
          - name: image_data_modified
          - name: loinc_code
          - name: loinc_contrast
          - name: loinc_long_common_name
          - name: loinc_method
          - name: loinc_system
          - name: study_description
          - name: study_modality
          - name: study_year
          - name: study_year_shifted
          - name: study_uid
        root: imaging_study
        type: aggregator
      - category: data_file
        doc_type: data_file
        injecting_props:
          annotation:
            props:
              - fn: set
                name: _annotation_id
                src: id
          case:
            props:
              - fn: set
                name: _case_id
                src: id
              - fn: set
                name: age_at_index
                src: age_at_index
              - fn: set
                name: covid19_positive
                src: covid19_positive
              - fn: set
                name: ethnicity
                src: ethnicity
              - fn: set
                name: index_event
                src: index_event
              - fn: set
                name: race
                src: race
              - fn: set
                name: sex
                src: sex
              - fn: set
                name: zip
                src: zip
          dataset:
            props:
              - fn: set
                name: _dataset_id
                src: id
              - fn: set
                name: dataset_submitter_id
                src: submitter_id
              - fn: set
                name: license
                src: license
              - fn: set
                name: data_url_doi
                src: data_url_doi
              - fn: set
                name: data_contributor
                src: data_contributor
          imaging_study:
            props:
              - fn: set
                name: _imaging_study_id
                src: id
              - fn: set
                name: age_at_imaging
                src: age_at_imaging
              - fn: set
                name: body_part_examined
                src: body_part_examined
              - fn: set
                name: days_from_study_to_neg_covid_test
                src: days_from_study_to_neg_covid_test
              - fn: set
                name: days_from_study_to_pos_covid_test
                src: days_from_study_to_pos_covid_test
              - fn: set
                name: days_to_study
                src: days_to_study
              - fn: set
                name: study_description
                src: study_description
              - fn: set
                name: study_modality
                src: study_modality
              - fn: set
                name: study_year
                src: study_year
              - fn: set
                name: study_year_shifted
                src: study_year_shifted
              - fn: set
                name: study_uid
                src: study_uid
              - fn: set
                name: loinc_code
                src: loinc_code
              - fn: set
                name: loinc_contrast
                src: loinc_contrast
              - fn: set
                name: loinc_long_common_name
                src: loinc_long_common_name
              - fn: set
                name: loinc_method
                src: loinc_method
              - fn: set
                name: loinc_system
                src: loinc_system
        name: midrcstaging_data_file
        props:
          - name: source_node
          - name: project_id
          - name: submitter_id
          - name: series_uid
          - name: case_ids
          - name: object_id
          - name: md5sum
          - name: file_name
          - name: file_size
          - name: data_format
          - name: data_type
          - name: data_category
          - name: annotation_method
          - name: annotation_name
          - name: annotator_id
          - name: instance_uids
          - name: software_versions
          - name: acquisition_type
          - name: angio_flag
          - name: contrast_bolus_agent
          - name: convolution_kernel
          - name: detector_type
          - name: diffusion_b_value
          - name: diffusion_gradient_orientation
          - name: echo_number
          - name: echo_time
          - name: echo_train_length
          - name: exposure_modulation_type
          - name: image_data_modified
          - name: image_data_modification_method
          - name: image_data_modification_name
          - name: image_type
          - name: imaged_nucleus
          - name: imager_pixel_spacing
          - name: lossy_image_compression
          - name: manufacturer
          - name: manufacturer_model_name
          - name: modality
          - name: number_of_instances
          - name: number_of_temporal_positions
          - name: patient_position
          - name: pixel_spacing
          - name: radiopharmaceutical
          - name: repetition_time
          - name: scan_options
          - name: sequence_variant
          - name: series_description
          - name: slice_thickness
          - name: software_version
          - name: spacing_between_slices
          - name: spatial_resolution
          - name: transducer_type
          - name: view_position
        root: None
        type: collector
  image:
    tube:
      tag: '2025.09'
    spark:
      tag: '2025.09'
fence:
  autoscaling:
    enabled: false
    maxReplicas: 4
    minReplicas: 1
    targetCPUUtilizationPercentage: 40
  replicaCount: 4
  enabled: true
  externalSecrets:
    createK8sGoogleAppSecrets: true
    fenceConfig: midrcstaging-fence-config
    fenceJwtKeys: midrcstaging-fence-jwt
  image:
    repository: 707767160287.dkr.ecr.us-east-1.amazonaws.com/gen3/fence
    tag: '11.4.0'
  serviceAccount:
    annotations:
      eks.amazonaws.com/role-arn: arn:aws:iam::813684607867:role/midrcprod--midrcstaging-helm--audit-sqs-sender
  usersync:
    usersync: true
    userYamlS3Path: s3://cdis-gen3-users/midrcstaging/user.yaml
fluentd:
  enabled: true
  image:
    repository: fluent/fluentd-kubernetes-daemonset
    tag: v1.15.3-debian-cloudwatch-1.0
global:
  pdb: true
  aws:
    account: '813684607867'
    awsEsProxyRole: midrcprod--midrcstaging-helm--es-access
    enabled: true
    secretStoreServiceAccount:
      enabled: true
      roleArn: arn:aws:iam::813684607867:role/midrcprod--midrcstaging-helm--external-secrets-sa
    wafv2:
      # -- (bool) Set to true if using AWS WAFv2
      enabled: true
      # -- (string) ARN for the WAFv2 ACL.
      wafAclArn: "arn:aws:wafv2:us-east-1:813684607867:regional/webacl/midrcprod-waf/6dae1fe2-287d-4cec-9537-0b8fa1f7d93c"
  dev: false
  dictionaryUrl: https://s3.amazonaws.com/dictionary-artifacts/midrc_dictionary/1.4.0/schema.json
  dispatcherJobNum: '10'
  environment: midrcstaging
  externalSecrets:
    deploy: true
    createSlackWebhookSecret: true
    slackWebhookSecretName: midrcstaging-slack-webhook
  hostname: staging.midrc.org
  manifestGlobalExtraValues:
    kube_bucket: kube-midrcprod-gen3
    logs_bucket: logs-midrcprod-gen3
  maintenanceMode: 'off'
  publicDataSets: false
  fenceURL: https://staging.midrc.org/user
  tierAccessLevel: private
  tierAccessLimit: 50
  portalApp: gitops
  postgres:
    dbCreate: false
  revproxyArn: arn:aws:acm:us-east-1:813684607867:certificate/d4bdf325-afce-4e1d-b431-0dd062ee12c5
guppy:
  authFilterField: auth_resource_path
  autoscaling:
    enabled: false
    maxReplicas: 4
    minReplicas: 1
    targetCPUUtilizationPercentage: 40
  replicaCount: 4
  configIndex: midrcstaging_array-config
  enabled: true
  esEndpoint: http://elasticsearch:9200
  image:
    repository: 707767160287.dkr.ecr.us-east-1.amazonaws.com/gen3/guppy
    tag: '2025.09'
  indices:
    - index: midrcstaging_case
      type: case
    - index: midrcstaging_measurement
      type: measurement
    - index: midrcstaging_annotation
      type: annotation
    - index: midrcstaging_data_file
      type: data_file
    - index: midrcstaging_imaging_study
      type: imaging_study
hatchery:
  enabled: true
  jupyterNamespace: jupyter-pods-midrcstaging-helm
  image:
    repository: 707767160287.dkr.ecr.us-east-1.amazonaws.com/gen3/hatchery
    tag: '2025.09'
  hatchery:
    json: |-
      {
        "user-namespace": "jupyter-pods",
        "sub-dir": "/workspace",
        "user-volume-size": "10Gi",
        "sidecar": {
          "cpu-limit": "1.0",
          "memory-limit": "256Mi",
          "image": "quay.io/cdis/ecs-ws-sidecar:2025.08",
          "env": {
            "NAMESPACE": "default",
            "GEN3_ENDPOINT": "data.midrc.org",
            "HOSTNAME": "data.midrc.org"
          },
          "args": [],
          "command": [
            "/bin/bash",
            "./sidecar.sh"
          ],
          "lifecycle-pre-stop": [
            "su",
            "-c",
            "echo test",
            "-s",
            "/bin/sh",
            "root"
          ]
        },
        "containers": [
          {
            "target-port": 8888,
            "cpu-limit": "1.0",
            "memory-limit": "2Gi",
            "name": "(Generic) Jupyter Lab Notebook with R Kernel",
            "image": "quay.io/cdis/jupyter-superslim-r:2.0.1",
            "env": {
              "FRAME_ANCESTORS": "https://staging.midrc.org"
            },
            "args": [
              "--JupyterNotebookApp.base_url=/lw-workspace/proxy/",
              "--JupyterNotebookApp.default_url=/lab",
              "--JupyterNotebookApp.password=''",
              "--JupyterNotebookApp.token=''",
              "--JupyterNotebookApp.ip='*'",
              "--JupyterNotebookApp.notebook_dir='/home/jovyan'",
              "--JupyterNotebookApp.shutdown_no_activity_timeout=5400",
              "--JupyterNotebookApp.quit_button=False"
            ],
            "command": [
              "start-notebook.sh"
            ],
            "path-rewrite": "/lw-workspace/proxy/",
            "use-tls": "false",
            "ready-probe": "/lw-workspace/proxy/",
            "lifecycle-post-start": [
              "/bin/sh",
              "-c",
              "export IAM=`whoami`; rm -rf /home/$IAM/pd/dockerHome; rm -rf /home/$IAM/pd/lost+found; ln -s /data /home/$IAM/; rm /home/$IAM/pd/data; wget -O /data/external_data_download.ipynb https://raw.githubusercontent.com/uc-cdis/heal-platform-sdk/refs/heads/master/notebooks/external_data_download.ipynb; true"
            ],
            "user-uid": 1000,
            "fs-gid": 100,
            "user-volume-location": "/home/jovyan/pd",
            "gen3-volume-location": "/home/jovyan/.gen3"
          },
          {
            "target-port": 8888,
            "cpu-limit": "1.0",
            "memory-limit": "2Gi",
            "name": "MIDRC Tutorial Jupyter Notebook",
            "image": "quay.io/cdis/jupyter-notebook:midrc-chore_midrc-container-gh-action",
            "env": {
              "FRAME_ANCESTORS": "https://staging.midrc.org"
            },
            "args": [
              "--JupyterNotebookApp.base_url=/lw-workspace/proxy/",
              "--JupyterNotebookApp.default_url=/lab",
              "--JupyterNotebookApp.password=''",
              "--JupyterNotebookApp.token=''",
              "--JupyterNotebookApp.ip='*'",
              "--JupyterNotebookApp.notebook_dir='/home/jovyan'",
              "--JupyterNotebookApp.shutdown_no_activity_timeout=5400",
              "--JupyterNotebookApp.quit_button=False"
            ],
            "command": [
              "start-notebook.sh"
            ],
            "path-rewrite": "/lw-workspace/proxy/",
            "use-tls": "false",
            "ready-probe": "/lw-workspace/proxy/",
            "lifecycle-post-start": [
              "/bin/sh",
              "-c",
              "export IAM=`whoami`; rm -rf /home/$IAM/pd/dockerHome; rm -rf /home/$IAM/pd/lost+found; ln -s /data /home/$IAM/; rm /home/$IAM/pd/data; wget -O /data/external_data_download.ipynb https://raw.githubusercontent.com/uc-cdis/heal-platform-sdk/refs/heads/master/notebooks/external_data_download.ipynb; true"
            ],
            "user-uid": 1000,
            "fs-gid": 100,
            "user-volume-location": "/home/jovyan/pd",
            "gen3-volume-location": "/home/jovyan/.gen3"
          }
        ]
      }
indexd:
  defaultPrefix: dg.MD1R/
  autoscaling:
    enabled: false
    maxReplicas: 10
    minReplicas: 1
    targetCPUUtilizationPercentage: 40
  replicaCount: 4
  enabled: true
  externalSecrets:
    serviceCreds: midrcstaging-indexd-service-creds
  image:
    repository: 707767160287.dkr.ecr.us-east-1.amazonaws.com/gen3/indexd
    tag: '2025.09'
manifestservice:
  enabled: false
metadata:
  autoscaling:
    enabled: false
    maxReplicas: 10
    minReplicas: 1
    targetCPUUtilizationPercentage: 40
  replicaCount: 4
  enabled: true
  esEndpoint: http://elasticsearch:9200
  externalSecrets:
    metadataG3auto: midrcstaging-metadata-g3auto
  image:
    repository: 707767160287.dkr.ecr.us-east-1.amazonaws.com/gen3/metadata-service
    tag: '2025.09'
ohif-viewer:
  enabled: true
  image:
    repository: 707767160287.dkr.ecr.us-east-1.amazonaws.com/gen3/ohif-viewer
    tag: gen3-v3.9.3
orthanc:
  enabled: true
  image:
    repository: quay.io/cdis/gen3-orthanc
    tag: orthancteam-master-gen3-24.3.5
  replicaCount: 1
  externalSecrets:
    orthancS3G3Auto: midrcstaging-orthanc-s3-g3auto
peregrine:
  autoscaling:
    enabled: false
    maxReplicas: 10
    minReplicas: 1
    targetCPUUtilizationPercentage: 40
  replicaCount: 4
  enabled: true
  image:
    repository: 707767160287.dkr.ecr.us-east-1.amazonaws.com/gen3/peregrine
    tag: '2025.09'
portal:
  autoscaling:
    enabled: false
    maxReplicas: 4
    minReplicas: 1
    targetCPUUtilizationPercentage: 40
  replicaCount: 4
  enabled: true
  customConfig:
    enabled: true
    dir: "midrcprod/staging.midrc.org/values/portal/"
    repo: https://github.com/uc-cdis/gen3-gitops.git
    branch: master
  image:
    repository: 707767160287.dkr.ecr.us-east-1.amazonaws.com/gen3/data-portal
    tag: '5.39.2'
requestor:
  enabled: true
  image:
    repository: 707767160287.dkr.ecr.us-east-1.amazonaws.com/gen3/requestor
    tag: '2025.09'
revproxy:
  autoscaling:
    enabled: false
    maxReplicas: 4
    minReplicas: 1
    targetCPUUtilizationPercentage: 40
  replicaCount: 4
  enabled: true
  image:
    repository: 707767160287.dkr.ecr.us-east-1.amazonaws.com/gen3/nginx
    tag: '2025.09'
  ingress:
    aws:
      group: midrcprod
sheepdog:
  autoscaling:
    enabled: false
    maxReplicas: 10
    minReplicas: 1
    targetCPUUtilizationPercentage: 40
  replicaCount: 4
  enabled: true
  image:
    repository: 707767160287.dkr.ecr.us-east-1.amazonaws.com/gen3/sheepdog
    tag: '2025.09'
spark:
  enabled: true
  image:
    repository: 707767160287.dkr.ecr.us-east-1.amazonaws.com/gen3/gen3-spark
    tag: '2025.08'
ssjdispatcher:
  serviceAccount:
    annotations:
      eks.amazonaws.com/role-arn: arn:aws:iam::813684607867:role/gen3_service/midrcprod--midrcstaging--ssj
  jobServiceAccount:
    annotations:
      eks.amazonaws.com/role-arn: arn:aws:iam::813684607867:role/gen3_service/midrcprod--midrcstaging--ssj-job
  enabled: true
  externalSecrets:
    credsFile: midrcstaging-ssjdispatcher-creds
  gen3Namespace: midrcstaging-helm
  image:
    repository: 707767160287.dkr.ecr.us-east-1.amazonaws.com/gen3/ssjdispatcher
    tag: '2025.09'
  indexing: quay.io/cdis/indexs3client:2025.09
tube:
  enabled: true
  image:
    repository: 707767160287.dkr.ecr.us-east-1.amazonaws.com/gen3/tube
    tag: '2025.08'
wts:
  enabled: true
  externalSecrets:
    createWtsOidcClientSecret: false
    wtsG3auto: midrcstaging-wts-g3auto
    wtsOidcClient: midrcstaging-wts-client-secret
  image:
    repository: 707767160287.dkr.ecr.us-east-1.amazonaws.com/gen3/workspace-token-service
    tag: '2025.09'
