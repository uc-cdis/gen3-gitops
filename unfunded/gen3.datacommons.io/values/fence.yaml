fence:
  # Lower cost
  resources:
    requests:
      memory: "105Mi"
      cpu: "15m"
  enabled: true
  replicaCount: 2
  image:
    repository: 707767160287.dkr.ecr.us-east-1.amazonaws.com/gen3/fence
    tag: master
  env:
    - name: GEN3_UWSGI_TIMEOUT
      valueFrom:
        configMapKeyRef:
          name: manifest-global
          key: uwsgi-timeout
          optional: true
    - name: DD_AGENT_HOST
      valueFrom:
        fieldRef:
          fieldPath: status.hostIP
    - name: AWS_STS_REGIONAL_ENDPOINTS
      value: regional
    - name: PYTHONPATH
      value: /var/www/fence
    - name: GEN3_DEBUG
      value: "False"
    - name: PGHOST
      valueFrom:
        secretKeyRef:
          name: fence-dbcreds
          key: host
          optional: false
    - name: PGUSER
      valueFrom:
        secretKeyRef:
          name: fence-dbcreds
          key: username
          optional: false
    - name: PGPASSWORD
      valueFrom:
        secretKeyRef:
          name: fence-dbcreds
          key: password
          optional: false
    - name: PGDB
      valueFrom:
        secretKeyRef:
          name: fence-dbcreds
          key: database
          optional: false
    - name: DBREADY
      valueFrom:
        secretKeyRef:
          name: fence-dbcreds
          key: dbcreated
          optional: false
    - name: DB
      value: postgresql://$(PGUSER):$(PGPASSWORD)@$(PGHOST):5432/$(PGDB)
    - name: INDEXD_PASSWORD
      valueFrom:
        secretKeyRef:
          name: indexd-service-creds
          key: fence
    - name: INDEXD_USERNAME
      value: "fence_oadc"
    - name: gen3Env
      valueFrom:
        configMapKeyRef:
          name: manifest-global
          key: hostname

  # -- (map) Annotations to add to the pod
  podAnnotations:
    prometheus.io/path: /metrics
    prometheus.io/scrape: "true"

  usersync:
    # -- (bool) Whether to run Fence usersync or not.
    usersync: true
    userYamlS3Path: s3://cdis-gen3-users/g3dh/user.yaml

  USER_YAML:

  # -- (map) External Secrets settings.
  externalSecrets:
    # -- (string) Will create the Helm "fence-jwt-keys" secret even if Secrets Manager is enabled. This is helpful if you are wanting to use External Secrets for some, but not all secrets.
    createK8sJwtKeysSecret: false
    # -- (string) Will create the Helm "fence-google-app-creds-secret" and "fence-google-storage-creds-secret" secrets even if Secrets Manager is enabled. This is helpful if you are wanting to use External Secrets for some, but not all secrets.
    createK8sGoogleAppSecrets: true
    # -- (string) Will override the name of the aws secrets manager secret. Default is "fence-jwt-keys"
    fenceJwtKeys: "oadc-fence-jwt"
    # -- (string) Will override the name of the aws secrets manager secret. Default is "fence-google-app-creds-secret"
    fenceGoogleAppCredsSecret:
    # -- (string) Will override the name of the aws secrets manager secret. Default is "fence-google-storage-creds-secret"
    fenceGoogleStorageCredsSecret:
    # -- (string) Will override the name of the aws secrets manager secret. Default is "fence-config"
    fenceConfig: "oadc-fence-config"
    # -- (string) Will override the name of the aws secrets manager secret. Default is "Values.global.environment-.Chart.Name-creds"
    dbcreds: "oadc-fence-db-creds"

  # -- (map) Public configuration settings for Fence app
  FENCE_CONFIG_PUBLIC:
    ENABLE_PROMETHEUS_METRICS: true
    ENABLE_DB_MIGRATION: true
